<script>
        function selectPayment(methodId) {
            // Remove selected class from all payment methods
            document.querySelectorAll('.payment-method').forEach(method => {
                method.classList.remove('selected');
            });
            
            // Add selected class to clicked method
            document.querySelector(`#${methodId}`).closest('.payment-method').classList.add('selected');
            
            // Check the radio button
            document.querySelector(`#${methodId}`).checked = true;
        }

        // Initialize first payment method as selected
        document.addEventListener('DOMContentLoaded', function() {
            const firstPayment = document.querySelector('.payment-method');
            if (firstPayment) {
                firstPayment.classList.add('selected');
            }
        });

        async function processPayment() {
            const selectedPayment = document.querySelector('input[name="payment_method"]:checked');
            if (!selectedPayment) {
                alert('Please select a payment method');
                return;
            }

            const checkoutBtn = document.querySelector('.checkout-btn');
            const btnText = checkoutBtn.querySelector('.btn-text');
            
            // Show loading state
            checkoutBtn.classList.add('loading');
            checkoutBtn.disabled = true;
            btnText.textContent = 'Processing...';

            try {
                const response = await fetch('{% url "process_payment" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    },
                    body: JSON.stringify({
                        payment_method: selectedPayment.value,
                        user_info: {
                            email: '{{ user.email }}' // This would come from logged-in user
                        }
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Show success message
                    btnText.textContent = 'Purchase Complete!';
                    
                    // Redirect after a short delay
                    setTimeout(() => {
                        if (data.redirect_url) {
                            window.location.href = data.redirect_url;
                        } else {
                            window.location.reload();
                        }
                    }, 1500);
                } else {
                    throw new Error(data.error || 'Payment failed');
                }

            } catch (error) {
                alert('Payment failed: ' + error.message);
                
                // Reset button state
                checkoutBtn.classList.remove('loading');
                checkoutBtn.disabled = false;
                btnText.textContent = 'Complete Purchase';
            }
        }

        // Handle messages from Django
        {% if messages %}
            {% for message in messages %}
                {% if message.tags == 'error' %}
                    alert('Error: {{ message|escapejs }}');
                {% elif message.tags == 'success' %}
                    // You could show a success toast here instead of alert
                    console.log('Success: {{ message|escapejs }}');
                {% endif %}
            {% endfor %}
        {% endif %}
    </script>
