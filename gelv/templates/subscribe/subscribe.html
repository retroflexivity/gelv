{% extends "base.html" %}

{% block title %}Subscribe{% endblock %}

{% block content %}
    <!-- Products List -->
    {% if journals %}
        <div class="subscriptions">
            {% for journal in journals %}
                <div class="item expanded">
                    <div class="header">
                        <div class="info">
                            <div class="name">{{ journal }}</div>
                        </div>
                        
                    </div>
                   <div class="description">
                        {{ journal.description|linebreaks }}
                    </div>
                    <div class="subscription-options">
                        {% for subscription in journal.get_subscriptions %}
                            <div class="option">
                                <p>{{ subscription.duration }} months</p>
                                <form method="post" action="{% url 'add_to_cart' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="type" value="subscription">
                                    <input type="hidden" name="id" value={{ subscription.id }}>
                                    <button type="submit" class="button-add">
                                        {% if subscription.discounted_price %}
                                            <div class="discount">{{ subscription.formatted_discounted_price }}</div>
                                        {% endif %}
                                        <div class="{% if subscription.discounted_price%}crossed{% endif %}">
                                            {{ subscription.formatted_price }}
                                        </div>
                                    </button>
                                </form>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
        
    {% else %}
        <div class="no-products">
            <h3>No subscriptions found</h3>
        </div>
    {% endif %}
</div>
    <script>
        // hide content until scroll is restored
        document.documentElement.classList.add('scroll-restoring');

        const stayForms = document.querySelectorAll('form[action*="/cart/"], form[class="sort-dropdown"]');
        stayForms.forEach(form => {
            function saveScroll() {
                sessionStorage.setItem('scrollPosition', window.pageYOffset);
            }
            form.addEventListener('submit', saveScroll);
            form.addEventListener('change', saveScroll);
        });

        // restore scroll position as early as possible
        document.addEventListener('DOMContentLoaded', function() {
            const scrollPosition = sessionStorage.getItem('scrollPosition');
            if (scrollPosition) {
                window.scrollTo(0, parseInt(scrollPosition));
                sessionStorage.removeItem('scrollPosition');
            }
    
            document.documentElement.classList.remove('scroll-restoring');
        });
    </script>
{% endblock %}

